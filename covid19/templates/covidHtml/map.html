
{% load static %}
<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet"  href="{%  static  'css/style.css'  %}">
    <link rel=“stylesheet” href=“https://cdn.jsdelivr.net/npm/fontisto@v3.0.4/css/fontisto/fontisto.min.css”>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://coronavirus-92ebd.web.app/assets/css/feather/feather.css" rel="stylesheet">
    <title></title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin="">
    </script>
    <link rel="stylesheet" href="style.css">
    <link rel="shortcut icon" type="image/x-icon" href="https://image.flaticon.com/icons/svg/2785/2785819.svg" />
    <style>

    </style>

</head>
<!-- World Wide infos-->
<div class="map-sidebar-numbers" data-infected="22083206" data-recovered="14713135" data-dead="785604">
    <div class="map-sidebar-section">
        <div class="map-sidebar-card active" data-title="infected">22,083,206</div>
    </div>
    <div class="map-sidebar-section">
        <div class="map-sidebar-card" data-title="dead" data-text="Deaths">785,604</div>
        <div class="map-sidebar-card" data-title="recovered" data-text="Recoveries">14,713,135</div>
    </div>
</div>

<div class="map-sidebar">
    <div class="app-sub-buttons">
        <div class="map-world-nbs">World</div>
        <div class="dropup ">
            <div class="map-sidebar-sort">Total cases</div>
            <div class="dropup-content type-filter">
                <div class="type-filter-title">Sort By</div>
                <div class="type-filter-el" id="TC">
                    <div class="type-filter-icon fa fa-user-plus"></div>
                    <div class="type-filter-name">Total cases</div>
                </div>
                <div class="type-filter-el" id="CPM">
                    <div class="type-filter-icon fa fa-users"></div>
                    <div class="type-filter-name">Cases per million</div>
                </div>
                <div class="type-filter-el" id="Rec">
                    <div class="type-filter-icon fa fa-home"></div>
                    <div class="type-filter-name">Recoveries</div>
                </div>
                <div class="type-filter-el" id="Ds">
                    <div class="type-filter-icon fa fa-remove"></div>
                    <div class="type-filter-name">Deaths</div>
                </div>
                <div class="type-filter-el" id="FR">
                    <div class="type-filter-icon fa fa-percent"></div>
                    <div class="type-filter-name">Fatality rate</div>
                </div>
                <div class="type-filter-el" id="DPM">
                    <div class="type-filter-icon fa fa-user-times"></div>
                    <div class="type-filter-name">Deaths per million</div>
                </div>
                <div class="type-filter-el" id="Act">
                    <div class="type-filter-icon fa fa-spinner"></div>
                    <div class="type-filter-name">Active cases</div>
                </div>
                <div class="type-filter-el" id="name">
                    <div class="type-filter-icon feather feather-align-left"></div>
                    <div class="type-filter-name">Name</div>
                </div>

            </div>
        </div>
    </div>
    <div class="app-top-bar">
        <div class="app-top-bar-inner">
            <div class="app-top-bar-inner-back animate"></div>
            <input class="app-top-bar-search" id="myInput" type="text" placeholder="Search 219 Countries...">
            <div class="map-sidebar-right-btns">
                <div class="map-sidebar-clear hide"></div>
            </div>
        </div>
    </div>
    <div class="map-sidebar-section column">
        <div class="map-sidebar-section-content">
        </div>
    </div>

</div>

<!-- Counpries Tri-->

<body onload="mff()">

    <!-- Make sure you put this AFTER Leaflet's CSS -->

    <div id="mapid"> </div>
    <script>
        var mymap = L.map('mapid').setView([33.8869, 9.5375], 5);
        L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 5,
            minZoom: 2.5,

            id: 'mapbox/streets-v11',
            tileSize: 512,
            zoomOffset: -1,
            accessToken: 'pk.eyJ1IjoicnlkZXIwNSIsImEiOiJja2R1ZXlmeWszZWY4MzByb2Yxbm52OHlrIn0.lOE-eNO5Bf1PWN63oNjUew'
        }).addTo(mymap);
    </script>
    <script>
        function Get(yourUrl) {
            var Httpreq = new XMLHttpRequest(); // a new request
            Httpreq.open("GET", yourUrl, false);
            Httpreq.send(null);
            return Httpreq.responseText;
        }
        var json_obj = JSON.parse(Get('https://disease.sh/v3/covid-19/countries?yesterday=false&allowNull=false'));
        var group1 = L.featureGroup();

        function DrawCircle(color, state) {
            group1.clearLayers()
            switch (state) {
                case "TC":
                    var str_ = "cases";
                    break;
                case "CPM":
                    var str_ = "casesPerOneMillion";
                    break;
                case "Rec":
                    var str_ = "recovered";
                    break;
                case "Ds":
                    var str_ = "deaths";
                    break;
                case "FR":
                    var str_ = "cases";
                    var state = "recovered";
                    break;
                case "DPM":
                    var str_ = "deathsPerOneMillion";
                    break;
                case "Act":
                    var str_ = "sick";
                    break;
                case "name":
                    var str_ = "cases";
                    break;
                default:
                    var str_ = "cases";

            }
            for (var i = 0; i < json_obj.length; i++) {
                let lat = json_obj[i]["countryInfo"]["lat"];
                let long = json_obj[i]["countryInfo"]["long"];
                let flag_url = json_obj[i]["countryInfo"]["flag"];
                let cases = json_obj[i][str_]
                let iso = json_obj[i]["countryInfo"]["iso3"];
                let country = json_obj[i]["country"];
                let todayCases = json_obj[i]["todayCases"];
                let Recoveries = json_obj[i]["recovered"];
                let Deaths = json_obj[i]["deaths"]
                if (cases > 1000000) {
                    radius = cases;
                } else if (cases < 1000000 && cases > 500000) {
                    radius = cases / 1;
                } else if (cases < 500000 && cases > 100000) {
                    radius = cases;
                } else if (cases < 100000 && cases > 50000) {
                    radius = cases;
                } else if (cases < 50000 && cases > 25000) {
                    radius = cases * 5;
                } else if (cases < 25000 && cases > 10000) {
                    radius = cases * 8;
                } else if (cases < 10000) {
                    radius = cases * 25;
                } else if (cases < 5000) {
                    radius = cases * 100;
                } else if (cases < 1000) {
                    radius = cases * 100000;
                }
                switch (color) {
                    case "red":
                        {
                            var circle = L.circle([lat, long], {
                                color: "#ff416c",
                                fillColor: '#f03',
                                fillOpacity: 0.4,
                                radius: radius,
                                color: "#ff416c",
                                strokeopacity: 0.5,
                                strokewidth: 1,
                                weight: 0,
                            }).addTo(group1);
                            break;
                        }
                    case "green":
                        {
                            console.log("green called");
                            var circle = L.circle([lat, long], {
                                color: "#00FA9A",
                                fillColor: '#00FA9A',
                                fillOpacity: 0.6,
                                radius: radius,
                                color: "#00FA9A",
                                strokeopacity: 0.5,
                                strokewidth: 1,
                                weight: 1,
                            }).addTo(group1);
                            break;

                        }
                    case "purple":
                        {
                            var circle = L.circle([lat, long], {
                                color: "#9370DB",
                                fillColor: '#9370DB',
                                fillOpacity: 0.6,
                                radius: radius,
                                color: "#9370DB",
                                strokeopacity: 0.5,
                                strokewidth: 1,
                                weight: 1,
                            }).addTo(group1);
                            break;

                        }
                }
                var popup2 = L.popup({
                    offset: L.point(15, 15)
                }).setContent('<div class="map-tooltip Tooltip main-map"><img src=' + flag_url + '><div class="map-tooltip-title"><div>' + country + '</div></div><div class="map-tooltip-new">+' + todayCases + '</div><div class="map-tooltip-line infected"><span>' + cases + '</span><span>Total cases</span></div><div class="map-tooltip-line recovered"><span>' + Recoveries + '</span><span>Recoveries</span></div><div class="map-tooltip-line dead"><span>' + Deaths + '</span><span>Deaths</span></div></div>');
                circle.bindPopup(popup2);
                circle.on("mouseover", function(evt) {
                    this.openPopup();
                });
            }
            mymap.addLayer(group1);

        }

        function fillred() {
            var cc = document.getElementsByTagName("path");
            for (i = 0; i < cc.length; i++) {
                cc[i].classList.add('MyClass')
                cc[i].style.fillOpacity = "0.5";
                cc[i].style.strokewidth = "2";
            }
        }
        DrawCircle("red");
        var wbg = document.getElementsByClassName("leaflet-popup-content-wrapper");
        for (i=0;i<wbg.length;i++){
            wbg[i].style.background="transparent";
            wbg[0].style.color= "transparent";



        }
        var zoi = document.getElementsByClassName("leaflet-left");
        for (i = 0; i < zoi.length; i++) {
            zoi[i].classList.add("CustomZoom");
            zoi[i].classList.remove("leaflet-left")
        }
    </script>
    <script>
        function mff() {
            console.log("sss");
            for (var i = 0; i < json_obj.length; i++) {
                let flag_url = json_obj[i]["countryInfo"]["flag"];
                let cases = json_obj[i]["cases"]
                let name = json_obj[i].country
                document.getElementsByClassName("map-sidebar-sort")[0].innerHTML = "Total Cases";
                cont.innerHTML += `<div class="map-sidebar-section-item">
         <div class="map-sidebar-section-item-img"><img class="flag-img" src=` + flag_url + `></div>
        <div class="map-sidebar-section-item-details">
          <div class="map-sidebar-section-item-title">` + name + `</div>
    </div>
     <div class="map-sidebar-section-item-nb infected">` + cases + `</div>
    </div> `;
            }
        }

        function mf(jsonfile, SortBy) {
            cont.innerHTML = "";
            switch (SortBy) {
                case "TC":
                    var str_ = "cases";
                    var state = "infected";
                    break;
                case "CPM":
                    var str_ = "casesPerOneMillion";
                    break;
                case "Rec":
                    var str_ = "recovered";
                    var state = "recovered";
                    break;
                case "Ds":
                    var str_ = "deaths";
                    var state = "dead";
                    break;
                case "FR":
                    var str_ = "cases";
                    var state = "recovered";
                    break;
                case "DPM":
                    var str_ = "deathsPerOneMillion";
                    var state = "dead";
                    break;
                case "Act":
                    var str_ = "sick";
                    break;
                case "name":
                    var str_ = "cases";
                    var state = "infected";
                    break;
                default:
                    var str_ = "cases";

            }
            for (var i = 0; i < jsonfile.length; i++) {
                let flag_url = jsonfile[i]["countryInfo"]["flag"];
                let name = jsonfile[i].country
                let Report = jsonfile[i][str_]
                console.log(state);
                cont.innerHTML += `<div class="map-sidebar-section-item">
         <div class="map-sidebar-section-item-img"><img class="flag-img" src=` + flag_url + `></div>
        <div class="map-sidebar-section-item-details">
          <div class="map-sidebar-section-item-title">` + name + `</div>
    </div>
     <div class="map-sidebar-section-item-nb `.concat(state) + `">` + Report + `</div>
    </div> `;
            }
        }
        var cont = document.getElementsByClassName("map-sidebar-section-content")[0];
        document.getElementById("TC").addEventListener("click", function() {
            document.getElementsByClassName("map-sidebar-sort")[0].innerHTML = "Total Cases";
            url = "https://disease.sh/v3/covid-19/countries?yesterday=false&twoDaysAgo=false&sort=cases&allowNull=false";
            var jsonf = JSON.parse(Get(url));
            mf(jsonf, "TC");
            DrawCircle("red", "TC");
        });
        <!-- Cases Per million  Sort -->

        document.getElementById("CPM").addEventListener("click", function() {
            document.getElementsByClassName("map-sidebar-sort")[0].innerHTML = "Cases Per Million";
            url = "https://disease.sh/v3/covid-19/countries?yesterday=false&twoDaysAgo=false&sort=casesPerOneMillion&allowNull=false";
            var jsonf = JSON.parse(Get(url));
            mf(jsonf, "CPM");
            DrawCircle("red", "CPM");
        });
        <!-- Recoveries Sort -->

        document.getElementById("Rec").addEventListener("click", function() {
            document.getElementsByClassName("map-sidebar-sort")[0].innerHTML = "Recoveries";
            url = "https://disease.sh/v3/covid-19/countries?yesterday=false&twoDaysAgo=false&sort=recovered&allowNull=false";
            var jsonf = JSON.parse(Get(url));
            mf(jsonf, "Rec");
            DrawCircle("green", "Rec");


        });
        <!-- Deaths Sort -->
        document.getElementById("Ds").addEventListener("click", function() {
            document.getElementsByClassName("map-sidebar-sort")[0].innerHTML = "Deaths";
            url = 'https://disease.sh/v3/covid-19/countries?yesterday=false&twoDaysAgo=false&sort=deaths&allowNull=false';
            var jsonf = JSON.parse(Get(url));
            mf(jsonf, "Ds");
            DrawCircle("purple", "Ds");


        });
        <!-- Fatality Rate Sort -->

        document.getElementById("FR").addEventListener("click", function() {
            document.getElementsByClassName("map-sidebar-sort")[0].innerHTML = "Fatality Rate";
            url = "";

        });
        <!-- Deaths Per Million Sort -->

        document.getElementById("DPM").addEventListener("click", function() {
            document.getElementsByClassName("map-sidebar-sort")[0].innerHTML = "Deaths Per Million";
            url = 'https://disease.sh/v3/covid-19/countries?yesterday=false&twoDaysAgo=false&sort=deathsPerOneMillion&allowNull=false';
            var jsonf = JSON.parse(Get(url));
            mf(jsonf, "DPM");
            DrawCircle("purple", "DPM");

        });
        document.getElementById("Act").addEventListener("click", function() {
            document.getElementsByClassName("map-sidebar-sort")[0].innerHTML = "Active Cases";
            url = "https://disease.sh/v3/covid-19/countries?yesterday=false&twoDaysAgo=false&sort=active&allowNull=false";
            var jsonf = JSON.parse(Get(url));

            mf(jsonf, "Act");
            DrawCircle("red", "Act");
        });
        document.getElementById("name").addEventListener("click", function() {
            document.getElementsByClassName("map-sidebar-sort")[0].innerHTML = "Name";
            url = "https://disease.sh/v3/covid-19/countries?yesterday=false&allowNull=false";
            var jsonf = JSON.parse(Get(url));
            mf(jsonf, "name");
            DrawCircle("red", "name");
        });
        document.getElementById("myInput").addEventListener("input", function() {
            val = this.value;
            url = "https://disease.sh/v3/covid-19/countries?yesterday=false&allowNull=false";
            var jsonf = JSON.parse(Get(url));
            for (i = 0; i < jsonf.length; i++) {

                if (jsonf[i].country.substr(0, val.length).toUpperCase() !== val.toUpperCase()) {
                    console.log(jsonf[i].country);
                    document.getElementsByClassName("map-sidebar-section-item")[i].style.display = "none";
                }
            }
            console.log("ss waffen");
        });
    </script>

</body>

</html>